---
import Layout from '../../layouts/Layout.astro';
import { getSupabase } from '../../lib/supabase';

const slug = Astro.params.slug;
if (!slug) return Astro.redirect('/');

const supabase = getSupabase();
const { data: post, error } = await supabase
  .from('posts')
  .select('id, title, slug, content, image_url, created_at')
  .eq('slug', slug)
  .single();

if (error || !post) return Astro.redirect('/');
---

<Layout>
  <main class="min-h-screen bg-background text-foreground p-8 max-w-2xl mx-auto">
    <a href="/" class="text-sm text-muted-foreground hover:text-foreground underline mb-4 inline-block">‚Üê Back to blog</a>
    <article>
      <h1 class="text-2xl font-semibold mb-2">{post.title}</h1>
      <time class="text-sm text-muted-foreground" datetime={post.created_at}>{new Date(post.created_at).toLocaleDateString()}</time>
      {post.image_url && (
        <img src={post.image_url} alt="" class="mt-4 rounded-md w-full object-cover max-h-64" />
      )}
      <div class="mt-4 prose prose-slate dark:prose-invert max-w-none" set:html={post.content.replace(/\n/g, '<br />')} />
    </article>
  </main>
</Layout>
